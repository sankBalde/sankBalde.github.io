import{a as N}from"./chunk-DBU6QSDP.js";import{i as $,k as H}from"./chunk-2O6BEIAH.js";import{c as q,d as O,i as R,q as G}from"./chunk-IAJIG4OQ.js";import{Bb as C,Cb as b,Db as v,Eb as V,Fa as u,J as W,Oa as P,T as S,Y as c,Z as m,ab as w,bb as y,db as A,ea as h,eb as T,ec as j,fb as F,gb as E,hb as l,ib as r,m as D,mb as M,nb as g,ob as d,v as L,w as I,xb as a,yb as k,zb as B}from"./chunk-WBYVMQEE.js";import{a as _,b as f}from"./chunk-C6Q5SG76.js";var K=(s,n)=>n.slug;function U(s,n){s&1&&(l(0,"div",6),a(1,"Chargement de la formation..."),r())}function X(s,n){if(s&1&&(l(0,"div",7),a(1),r()),s&2){let e=d();u(),k(e.error())}}function Y(s,n){if(s&1){let e=M();l(0,"div",28)(1,"label",29)(2,"input",30),g("change",function(i){let o=c(e).$implicit,p=d().$implicit,x=d(2);return m(x.onToggleSection(p,o,i))}),r(),l(3,"span",31),a(4),r()(),l(5,"button",32),g("click",function(){let i=c(e).$implicit,o=d().$implicit,p=d(2);return m(p.goToEditSection(o.slug,i))}),a(6," \xC9diter le contenu "),r()()}if(s&2){let e=n.$implicit,t=d().$implicit;u(2),E("checked",t.sections.includes(e)),u(2),k(e)}}function Z(s,n){if(s&1){let e=M();l(0,"div",17)(1,"div",20)(2,"h3",21)(3,"input",22),v("ngModelChange",function(i){let o=c(e).$implicit;return b(o.title,i)||(o.title=i),m(i)}),g("input",function(i){let o=c(e).$implicit,p=d(2);return m(p.onModuleTitleChange(o,i))}),r()(),l(4,"button",23),g("click",function(){let i=c(e).$implicit,o=d(2);return m(o.removeModule(i))}),a(5," Supprimer le module "),r()(),l(6,"div",10)(7,"label",24),a(8,"Slug du module:"),r(),l(9,"input",25),v("ngModelChange",function(i){let o=c(e).$implicit;return b(o.slug,i)||(o.slug=i),m(i)}),g("input",function(i){let o=c(e).$implicit,p=d(2);return m(p.onModuleSlugChange(o,i))}),r()(),l(10,"h4",26),a(11,"Sections du module:"),r(),l(12,"div",27),T(13,Y,7,2,"div",28,A),r()()}if(s&2){let e=n.$implicit,t=d(2);u(3),C("ngModel",e.title),u(4),E("for",V("moduleSlug-",e.slug)),u(2),E("id",V("moduleSlug-",e.slug)),C("ngModel",e.slug),u(4),F(t.allAvailableSections)}}function ee(s,n){if(s&1){let e=M();l(0,"div",8)(1,"h2",9),a(2,"D\xE9tails de la Formation"),r(),l(3,"div",10)(4,"label",11),a(5,"Titre de la Formation:"),r(),l(6,"input",12),v("ngModelChange",function(i){c(e);let o=d();return b(o.editedTitle,i)||(o.editedTitle=i),m(i)}),g("input",function(i){c(e);let o=d();return m(o.onTitleChange(i))}),r()(),l(7,"div",10)(8,"label",13),a(9,"Description de la Formation:"),r(),l(10,"textarea",14),v("ngModelChange",function(i){c(e);let o=d();return b(o.editedDesc,i)||(o.editedDesc=i),m(i)}),g("input",function(i){c(e);let o=d();return m(o.onDescChange(i))}),r()(),l(11,"p",15),a(12),r()(),l(13,"h2",9),a(14,"Modules"),r(),l(15,"div",16),T(16,Z,15,6,"div",17,K),r(),l(18,"button",18),g("click",function(){c(e);let i=d();return m(i.addModule())}),l(19,"span",19),a(20,"+"),r(),a(21," Ajouter un nouveau module "),r()}if(s&2){let e=d();u(6),C("ngModel",e.editedTitle),u(4),C("ngModel",e.editedDesc),u(2),B("Slug de la formation: ",e.formation().slug),u(4),F(e.formation().modules)}}var Q=class s{route=S($);router=S(H);courseService=S(N);formation=h(null);isLoading=h(!0);error=h(null);editedTitle=h("");editedDesc=h("");allAvailableSections=["Tutoriels","QCM","Exercices","Projets"];ngOnInit(){this.route.paramMap.pipe(L(n=>n.has("slug")),W(n=>{let e=n.get("slug");return this.isLoading.set(!0),this.error.set(null),this.courseService.getFormationBySlug(e).pipe(I(t=>(console.error("Error loading formation:",t),this.error.set("Failed to load formation. Please try again."),this.isLoading.set(!1),D(()=>t))))})).subscribe(n=>{this.formation.set(n),this.editedTitle.set(n.title),this.editedDesc.set(n.desc),this.isLoading.set(!1)})}onTitleChange(n){let e=n.target;this.editedTitle.set(e.value)}onDescChange(n){let e=n.target;this.editedDesc.set(e.value)}goToEditSection(n,e){let t=this.formation()?.slug;t?e=="QCM"?this.router.navigate(["/qcm"],{queryParams:{formationSlug:t,moduleSlug:n,sectionName:e,filename:"1.html"}}):this.router.navigate(["/edit-content"],{queryParams:{formationSlug:t,moduleSlug:n,sectionName:e,filename:"1.html"}}):console.warn("Cannot navigate to edit section: formation slug is missing.")}addModule(){this.formation.update(n=>{if(!n)return null;let e={slug:`new-module-${Date.now()}`,title:"Nouveau Module",sections:[]};return f(_({},n),{modules:[...n.modules,e]})})}removeModule(n){this.formation.update(e=>e?confirm(`\xCAtes-vous s\xFBr de vouloir supprimer le module "${n.title}" ?`)?f(_({},e),{modules:e.modules.filter(t=>t.slug!==n.slug)}):e:null)}onModuleTitleChange(n,e){let t=e.target;this.formation.update(i=>i?f(_({},i),{modules:i.modules.map(o=>o.slug===n.slug?f(_({},o),{title:t.value}):o)}):null)}onModuleSlugChange(n,e){let t=e.target;this.formation.update(i=>i?f(_({},i),{modules:i.modules.map(o=>o.slug===n.slug?f(_({},o),{slug:t.value}):o)}):null)}onToggleSection(n,e,t){let o=t.target.checked;this.formation.update(p=>p?f(_({},p),{modules:p.modules.map(x=>{if(x.slug===n.slug){let z=o?[...new Set([...x.sections,e])]:x.sections.filter(J=>J!==e);return f(_({},x),{sections:z})}return x})}):null)}saveFormationChanges(){let n=this.formation();if(!n){alert("Aucune formation \xE0 sauvegarder.");return}let e=f(_({},n),{title:this.editedTitle(),desc:this.editedDesc()});console.log("Attempting to save formation:",e),this.courseService.updateFormation(e).subscribe({next:t=>{console.log("Formation structure updated successfully:",t),alert("Formation structure saved successfully!"),this.formation.set(t),this.editedTitle.set(t.title),this.editedDesc.set(t.desc)},error:t=>{console.error("Error saving formation structure:",t),alert("Failed to save formation structure. Check console for details.")}})}goBackToGestion(){this.router.navigate(["/formations/gestion"])}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=P({type:s,selectors:[["app-edit-formation-structure"]],decls:12,vars:3,consts:[[1,"container","mx-auto","py-12","px-4"],[1,"flex","justify-between","items-center","mb-6"],[1,"text-3xl","font-bold"],[1,"flex","gap-4"],[1,"bg-green-600","text-white","px-4","py-2","rounded","hover:bg-green-700","transition",3,"click"],[1,"bg-gray-600","text-white","px-4","py-2","rounded","hover:bg-gray-700","transition",3,"click"],[1,"text-center","text-lg","text-gray-600"],[1,"text-center","text-lg","text-red-600"],[1,"bg-white","shadow-md","rounded-lg","p-6","mb-8"],[1,"text-2xl","font-semibold","mb-4"],[1,"mb-4"],["for","formationTitle",1,"block","text-gray-700","text-sm","font-bold","mb-2"],["type","text","id","formationTitle",1,"shadow","appearance-none","border","rounded","w-full","py-2","px-3","text-gray-700","leading-tight","focus:outline-none","focus:shadow-outline",3,"ngModelChange","input","ngModel"],["for","formationDesc",1,"block","text-gray-700","text-sm","font-bold","mb-2"],["id","formationDesc","rows","3",1,"shadow","appearance-none","border","rounded","w-full","py-2","px-3","text-gray-700","leading-tight","focus:outline-none","focus:shadow-outline",3,"ngModelChange","input","ngModel"],[1,"text-gray-600","text-sm","mb-4"],[1,"space-y-8"],[1,"bg-white","shadow-md","rounded-lg","p-6","border","border-gray-200"],[1,"mt-8","bg-purple-600","text-white","px-6","py-3","rounded-lg","hover:bg-purple-700","transition","flex","items-center","justify-center",3,"click"],[1,"text-xl","mr-2"],[1,"flex","justify-between","items-center","mb-4"],[1,"text-xl","font-bold"],["type","text",1,"font-bold","text-xl","appearance-none","border-b","border-gray-300","focus:outline-none","focus:border-blue-500","bg-transparent","w-full",3,"ngModelChange","input","ngModel"],[1,"text-red-500","hover:text-red-700","font-bold","px-3","py-1","rounded",3,"click"],[1,"block","text-gray-700","text-sm","font-bold","mb-2",3,"for"],["type","text",1,"shadow","appearance-none","border","rounded","w-full","py-2","px-3","text-gray-700","leading-tight","focus:outline-none","focus:shadow-outline","text-sm","bg-gray-50",3,"ngModelChange","input","id","ngModel"],[1,"text-lg","font-semibold","mb-3","mt-6"],[1,"grid","grid-cols-2","md:grid-cols-3","lg:grid-cols-4","gap-4"],[1,"flex","items-center","justify-between","bg-gray-100","p-3","rounded-lg","border","border-gray-200"],[1,"flex","items-center","cursor-pointer"],["type","checkbox",1,"form-checkbox","h-5","w-5","text-blue-600",3,"change","checked"],[1,"ml-2","text-gray-700"],[1,"bg-blue-500","text-white","text-sm","px-3","py-1","rounded","hover:bg-blue-600","transition","ml-2",3,"click"]],template:function(e,t){e&1&&(l(0,"div",0)(1,"div",1)(2,"h1",2),a(3,"Modifier la structure de la formation"),r(),l(4,"div",3)(5,"button",4),g("click",function(){return t.saveFormationChanges()}),a(6," Sauvegarder les modifications "),r(),l(7,"button",5),g("click",function(){return t.goBackToGestion()}),a(8," Retour \xE0 la gestion "),r()()(),w(9,U,2,0,"div",6),w(10,X,2,1,"div",7),w(11,ee,22,3),r()),e&2&&(u(9),y(t.isLoading()?9:-1),u(),y(t.error()?10:-1),u(),y(t.formation()?11:-1))},dependencies:[j,G,q,O,R],encapsulation:2})};export{Q as EditFormationStructureComponent};
