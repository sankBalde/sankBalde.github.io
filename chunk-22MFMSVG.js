import{A as u,H as d,Ja as p,O as y,P as v,Pa as P,Qa as A,S as c,Va as m,Wa as S,_ as D,g as h,h as w,i as E,ka as N,n as T,v as k}from"./chunk-WBYVMQEE.js";import{a as l}from"./chunk-C6Q5SG76.js";var O=class{constructor(){}loadScript(s,U,t,i=null){if(typeof document<"u"&&!document.getElementById(s)){let e=document.createElement("script");e.async=!0,e.src=U,e.onload=t,i||(i=document.head),i.appendChild(e)}}},_=class{},I=()=>typeof window.google?.accounts<"u",L=()=>{if(!I())throw new Error("Google Accounts API is undefined")},g=()=>(L(),window.google.accounts),z={oneTapEnabled:!0},f=(()=>{let s=class s extends O{constructor(t,i){super(),this.clientId=t,this.initOptions=i,this.changeUser=new m,this._socialUser=new h(null),this._accessToken=new h(null),this._receivedAccessToken=new m,this.initOptions=l(l({},z),this.initOptions),this._socialUser.pipe(d(1)).subscribe(this.changeUser),this._accessToken.pipe(d(1)).subscribe(this._receivedAccessToken)}initialize(t,i){return new Promise((e,n)=>{try{this.loadScript(s.PROVIDER_ID,this.getGoogleLoginScriptSrc(i),()=>{if(I()){if(google.accounts.id.initialize({client_id:this.clientId,auto_select:t,callback:({credential:o})=>{let r=this.createSocialUser(o);this._socialUser.next(r)},prompt_parent_id:this.initOptions?.prompt_parent_id,itp_support:this.initOptions.oneTapEnabled,use_fedcm_for_prompt:this.initOptions.oneTapEnabled}),this.initOptions.oneTapEnabled&&this._socialUser.pipe(k(o=>o===null)).subscribe(()=>google.accounts.id.prompt(console.debug)),this.initOptions.scopes){let o=this.initOptions.scopes instanceof Array?this.initOptions.scopes.filter(r=>r).join(" "):this.initOptions.scopes;this._tokenClient=google.accounts.oauth2.initTokenClient({client_id:this.clientId,scope:o,prompt:this.initOptions.prompt,callback:r=>{r.error?this._accessToken.error({code:r.error,description:r.error_description,uri:r.error_uri}):this._accessToken.next(r.access_token)}})}e()}})}catch(o){n(o)}})}getLoginStatus(){return new Promise((t,i)=>{this._socialUser.value?t(this._socialUser.value):i(`No user is currently logged in with ${s.PROVIDER_ID}`)})}refreshToken(){return new Promise((t,i)=>{g().id.revoke(this._socialUser.value.id,e=>{e.error?i(e.error):t(this._socialUser.value)})})}getAccessToken(){return new Promise((t,i)=>{this._tokenClient?(this._tokenClient.requestAccessToken({hint:this._socialUser.value?.email}),this._receivedAccessToken.pipe(u(1)).subscribe(t)):this._socialUser.value?i("No token client was instantiated, you should specify some scopes."):i("You should be logged-in first.")})}revokeAccessToken(){return new Promise((t,i)=>{this._tokenClient?this._accessToken.value?g().oauth2.revoke(this._accessToken.value,()=>{this._accessToken.next(null),t()}):i("No access token to revoke"):i("No token client was instantiated, you should specify some scopes.")})}signIn(){return Promise.reject('You should not call this method directly for Google, use "<asl-google-signin-button>" wrapper or generate the button yourself with "google.accounts.id.renderButton()" (https://developers.google.com/identity/gsi/web/guides/display-button#javascript)')}async signOut(){g().id.disableAutoSelect(),this._socialUser.next(null)}createSocialUser(t){let i=new _;i.idToken=t;let e=this.decodeJwt(t);return i.id=e.sub,i.name=e.name,i.email=e.email,i.photoUrl=e.picture,i.firstName=e.given_name,i.lastName=e.family_name,i}decodeJwt(t){let e=t.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(window.atob(e).split("").map(function(o){return"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(n)}getGoogleLoginScriptSrc(t){return t?`https://accounts.google.com/gsi/client?hl=${t}`:"https://accounts.google.com/gsi/client"}};s.PROVIDER_ID="GOOGLE";let a=s;return a})(),V=(()=>{let s=class s{get authState(){return this._authState.asObservable()}get initState(){return this._initState.asObservable()}constructor(t,i,e){this._ngZone=i,this._injector=e,this.providers=new Map,this.autoLogin=!1,this.lang="",this._user=null,this._authState=new w(1),this.initialized=!1,this._initState=new E,t instanceof Promise?t.then(n=>{this.initialize(n)}):this.initialize(t)}initialize(t){this.autoLogin=t.autoLogin!==void 0?t.autoLogin:!1,this.lang=t.lang!==void 0?t.lang:"";let{onError:i=console.error}=t;t.providers.forEach(e=>{this.providers.set(e.id,"prototype"in e.provider?this._injector.get(e.provider):e.provider)}),Promise.all(Array.from(this.providers.values()).map(e=>e.initialize(this.autoLogin,this.lang))).then(()=>{if(this.autoLogin){let e=[],n=!1;this.providers.forEach((o,r)=>{let R=o.getLoginStatus();e.push(R),R.then(b=>{this.setUser(b,r),n=!0}).catch(console.debug)}),Promise.all(e).catch(()=>{n||(this._user=null,this._authState.next(null))})}this.providers.forEach((e,n)=>{T(e.changeUser)&&e.changeUser.subscribe(o=>{this._ngZone.run(()=>{this.setUser(o,n)})})})}).catch(e=>{i(e)}).finally(()=>{this.initialized=!0,this._initState.next(this.initialized),this._initState.complete()})}async getAccessToken(t){let i=this.providers.get(t);if(this.initialized)if(i){if(!(i instanceof f))throw s.ERR_NOT_SUPPORTED_FOR_ACCESS_TOKEN}else throw s.ERR_LOGIN_PROVIDER_NOT_FOUND;else throw s.ERR_NOT_INITIALIZED;return await i.getAccessToken()}refreshAuthToken(t){return new Promise((i,e)=>{if(!this.initialized)e(s.ERR_NOT_INITIALIZED);else{let n=this.providers.get(t);n?typeof n.refreshToken!="function"?e(s.ERR_NOT_SUPPORTED_FOR_REFRESH_TOKEN):n.refreshToken().then(o=>{this.setUser(o,t),i()}).catch(o=>{e(o)}):e(s.ERR_LOGIN_PROVIDER_NOT_FOUND)}})}refreshAccessToken(t){return new Promise((i,e)=>{if(!this.initialized)e(s.ERR_NOT_INITIALIZED);else if(t!==f.PROVIDER_ID)e(s.ERR_NOT_SUPPORTED_FOR_REFRESH_TOKEN);else{let n=this.providers.get(t);n instanceof f?n.revokeAccessToken().then(i).catch(e):e(s.ERR_LOGIN_PROVIDER_NOT_FOUND)}})}signIn(t,i){return new Promise((e,n)=>{if(!this.initialized)n(s.ERR_NOT_INITIALIZED);else{let o=this.providers.get(t);o?o.signIn(i).then(r=>{this.setUser(r,t),e(r)}).catch(r=>{n(r)}):n(s.ERR_LOGIN_PROVIDER_NOT_FOUND)}})}signOut(t=!1){return new Promise((i,e)=>{if(!this.initialized)e(s.ERR_NOT_INITIALIZED);else if(!this._user)e(s.ERR_NOT_LOGGED_IN);else{let n=this._user.provider,o=this.providers.get(n);o?o.signOut(t).then(()=>{i(),this.setUser(null)}).catch(r=>{e(r)}):e(s.ERR_LOGIN_PROVIDER_NOT_FOUND)}})}setUser(t,i){t&&i&&(t.provider=i),this._user=t,this._authState.next(t)}};s.ERR_LOGIN_PROVIDER_NOT_FOUND="Login provider not found",s.ERR_NOT_LOGGED_IN="Not logged in",s.ERR_NOT_INITIALIZED="Login providers not ready yet. Are there errors on your console?",s.ERR_NOT_SUPPORTED_FOR_REFRESH_TOKEN="Chosen login provider is not supported for refreshing a token",s.ERR_NOT_SUPPORTED_FOR_ACCESS_TOKEN="Chosen login provider is not supported for getting an access token",s.\u0275fac=function(i){return new(i||s)(c("SocialAuthServiceConfig"),c(S),c(D))},s.\u0275prov=y({token:s,factory:s.\u0275fac,providedIn:"root"});let a=s;return a})();var H=(()=>{let s=class s{constructor(t,i){this.type="icon",this.size="medium",this.text="signin_with",this.shape="rectangular",this.theme="outline",this.logo_alignment="left",this.width=0,this.locale="",i.initState.pipe(u(1)).subscribe(()=>{Promise.resolve(this.width).then(e=>{e>400||e<200&&e!=0?Promise.reject("Please note .. max-width 400 , min-width 200 (https://developers.google.com/identity/gsi/web/tools/configurator)"):I()&&google.accounts.id.renderButton(t.nativeElement,{type:this.type,size:this.size,text:this.text,width:this.width,shape:this.shape,theme:this.theme,logo_alignment:this.logo_alignment,locale:this.locale})})})}};s.\u0275fac=function(i){return new(i||s)(p(N),p(V))},s.\u0275dir=A({type:s,selectors:[["asl-google-signin-button"]],inputs:{type:"type",size:"size",text:"text",shape:"shape",theme:"theme",logo_alignment:"logo_alignment",width:"width",locale:"locale"}});let a=s;return a})(),J=(()=>{let s=class s{};s.\u0275fac=function(i){return new(i||s)},s.\u0275mod=P({type:s}),s.\u0275inj=v({});let a=s;return a})();export{f as a,V as b,H as c,J as d};
